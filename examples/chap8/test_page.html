<!doctype html>

<html>

<head>
    <meta charset="utf-8">
    <title>CoreML Wasm WebRT</title>
</head>

<body>
    <script>
        function run() {
            var memory = new WebAssembly.Memory({
                initial: 2,
                maximum: 100
            });

            WebAssembly.instantiateStreaming(
                fetch(url),
                {
                    env: {
                        linear_memory: memory,
                        print_int: function (i) {
                            console.log(i);
                        },
                        print_bool: function (i) {
                            if (i == 0) {
                                console.log("false");
                            } else {
                                console.log("true");
                            }
                        },
                        print_string: function (ptr, len) {
                            /*
                            Rust スタイルの文字列が渡ってくる.
                            */
                            var bytes = new Uint8Array(memory.buffer, offset, length);
                            var string = new TextDecoder('utf8').decode(bytes);
                            console.log(string);
                        },
                        print_lparen: function () {
                            console.log("(");
                        },
                        print_rparen: function () {
                            console.log(")");
                        },
                        print_val: function () {
                            console.log("val");
                        },
                        print_comma: function () {
                            console.log(",");
                        },
                        print_equal: function () {
                            console.log("=");
                        },
                        print_colon: function () {
                            console.log(":");
                        },
                        print_arrow: function () {
                            console.log("->");
                        },
                        print_space: function () {
                            console.log(" ");
                        },
                        print_double_quote: function () {
                            console.log("\"");
                        },
                        print_new_line: function () {
                            console.log("\n");
                        }
                    }
                }
            ).then(obj => { });
        }
    </script>
</body>

</html>